{% extends "base.html" %}

{% block title %}{{ item.title }} - Stycly{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/product_detail.css') }}?v=300">
{% endblock %}

{% block content %}
<div class="product-detail-page">
    <!-- Breadcrumbs -->
    <nav class="breadcrumbs">
        <div class="container">
            <a href="{{ url_for('main.index') }}"><i class="fas fa-home"></i> Home</a>
            <span class="separator">/</span>
            <a href="{{ url_for('main.index') }}#products">Prodotti</a>
            <span class="separator">/</span>
            <span class="current">{{ item.title }}</span>
        </div>
    </nav>

    <div class="container product-container">
        <div class="product-grid">
            <!-- Image Gallery Section -->
            <div class="gallery-section">
                <!-- Main Image with Zoom -->
                <div class="main-image-container">
                    <div class="zoom-container" id="zoomContainer">
                        {% if image_paths and image_paths|length > 0 %}
                        <img src="{{ url_for('static', filename=image_paths[0]) }}"
                             alt="{{ item.title }}"
                             class="main-product-image"
                             id="mainImage">
                        {% else %}
                        <img src="https://via.placeholder.com/600x800?text={{ item.title }}"
                             alt="{{ item.title }}"
                             class="main-product-image"
                             id="mainImage">
                        {% endif %}
                        <div class="zoom-lens" id="zoomLens"></div>
                    </div>
                    <div class="zoom-result" id="zoomResult"></div>
                </div>

                <!-- Thumbnails -->
                <div class="thumbnails-container">
                    {% if image_paths and image_paths|length > 0 %}
                        {% for img_path in image_paths %}
                        <div class="thumbnail {% if loop.first %}active{% endif %}"
                             onclick="changeImage('{{ url_for('static', filename=img_path) }}', this)">
                            <img src="{{ url_for('static', filename=img_path) }}" alt="Thumbnail {{ loop.index }}">
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="thumbnail active">
                            <img src="https://via.placeholder.com/100?text=1" alt="Thumbnail">
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Product Info Section -->
            <div class="info-section">
                <div class="product-header">
                    <h1 class="product-title">{{ item.title }}</h1>

                    <!-- Badges -->
                    <div class="product-badges">
                        <span class="badge badge-category">{{ item.category or 'Abbigliamento' }}</span>
                        <span class="badge badge-destination">{{ item.destination or 'Bambino' }}</span>
                        {% if item.condition %}
                        <span class="badge badge-condition">{{ item.condition }}</span>
                        {% endif %}
                    </div>
                </div>

                <!-- Stock Availability Indicator -->
                <div class="stock-indicator">
                    {% if available_stock > 5 %}
                    <span class="stock-status in-stock">
                        <i class="fas fa-check-circle"></i> Disponibile ({{ available_stock }} pezzi)
                    </span>
                    {% elif available_stock > 0 %}
                    <span class="stock-status low-stock">
                        <i class="fas fa-exclamation-circle"></i> Solo {{ available_stock }} rimasti!
                    </span>
                    {% else %}
                    <span class="stock-status out-of-stock">
                        <i class="fas fa-times-circle"></i> Esaurito
                    </span>
                    {% endif %}
                </div>

                <!-- Description -->
                <div class="product-description">
                    <h3><i class="fas fa-info-circle"></i> Descrizione</h3>
                    <p>{{ item.description or 'Bellissimo capo per bambini, perfetto per ogni occasione. Materiali di qualità e design curato nei minimi dettagli.' }}</p>
                </div>

                <!-- Size Selector -->
                <div class="selector-group">
                    <label><i class="fas fa-ruler-combined"></i> Taglia</label>
                    <div class="size-selector">
                        <button class="size-option active" data-size="{{ item.size }}">
                            {{ item.size }}
                        </button>
                        {% if item.age_range %}
                        <button class="size-option disabled" disabled title="Non disponibile">
                            {{ item.age_range }}
                        </button>
                        {% endif %}
                    </div>
                </div>

                <!-- Color Selector -->
                <div class="selector-group">
                    <label><i class="fas fa-palette"></i> Colore</label>
                    <div class="color-selector">
                        <button class="color-option active"
                                data-color="{{ item.color or 'Multicolor' }}"
                                style="background: {% if item.color == 'White' %}#ffffff{% elif item.color == 'Black' %}#000000{% elif item.color == 'Red' %}#ff0000{% elif item.color == 'Blue' %}#0000ff{% elif item.color == 'Green' %}#00ff00{% elif item.color == 'Yellow' %}#ffff00{% else %}linear-gradient(45deg, #ff0000, #00ff00, #0000ff){% endif %};">
                            <i class="fas fa-check"></i>
                        </button>
                    </div>
                    <span class="color-name">{{ item.color or 'Multicolor' }}</span>
                </div>

                <!-- Quantity Picker -->
                <div class="selector-group">
                    <label><i class="fas fa-shopping-cart"></i> Quantità</label>
                    <div class="quantity-picker">
                        <button class="qty-btn" onclick="decreaseQuantity()" {% if available_stock <= 0 %}disabled{% endif %}>
                            <i class="fas fa-minus"></i>
                        </button>
                        <input type="number"
                               id="quantity"
                               value="1"
                               min="1"
                               max="{{ available_stock }}"
                               readonly
                               {% if available_stock <= 0 %}disabled{% endif %}>
                        <button class="qty-btn" onclick="increaseQuantity({{ available_stock }})" {% if available_stock <= 0 %}disabled{% endif %}>
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>

                <!-- Add to Cart Button -->
                <div class="action-buttons">
                    <button class="btn btn-add-cart"
                            onclick="addToCartDetail({{ item.id }})"
                            {% if available_stock <= 0 %}disabled{% endif %}>
                        <i class="fas fa-shopping-bag"></i> Aggiungi al Carrello
                    </button>
                    <button class="btn btn-request-quote">
                        <i class="fas fa-file-invoice"></i> Richiedi Preventivo
                    </button>
                </div>

                <!-- Product Features -->
                <div class="product-features">
                    <div class="feature-item">
                        <i class="fas fa-shield-alt"></i>
                        <div>
                            <strong>Qualità Garantita</strong>
                            <p>Articoli controllati e igienizzati</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-shipping-fast"></i>
                        <div>
                            <strong>Consegna Rapida</strong>
                            <p>Spedizione in 2-3 giorni lavorativi</p>
                        </div>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-undo"></i>
                        <div>
                            <strong>Reso Facile</strong>
                            <p>Procedura semplice e veloce</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Related Products Carousel -->
        {% if related_products and related_products|length > 0 %}
        <div class="related-section">
            <h2><i class="fas fa-th-large"></i> Prodotti Correlati</h2>
            <div class="related-carousel">
                <button class="carousel-btn prev" onclick="scrollCarousel('prev')">
                    <i class="fas fa-chevron-left"></i>
                </button>

                <div class="carousel-track" id="carouselTrack">
                    {% for product in related_products %}
                    <div class="related-card">
                        <a href="{{ url_for('shop.product_detail', product_id=product.id) }}" class="card-link">
                            <div class="related-image">
                                {% if product.image_paths and product.image_paths|length > 0 %}
                                <img src="{{ url_for('static', filename=product.image_paths[0]) }}" alt="{{ product.title }}">
                                {% else %}
                                <img src="https://via.placeholder.com/300x400?text={{ product.title }}" alt="{{ product.title }}">
                                {% endif %}
                                {% if product.stock and product.stock <= 3 %}
                                <span class="badge-overlay">Solo {{ product.stock }} rimasti!</span>
                                {% endif %}
                            </div>
                            <div class="related-info">
                                <h4>{{ product.title }}</h4>
                                <p class="related-meta">Taglia: {{ product.size }} | {{ product.color }}</p>
                                <div class="related-footer">
                                    <span class="condition-badge">{{ product.condition }}</span>
                                    <button class="btn-quick-add" onclick="event.preventDefault(); quickAdd({{ product.id }})">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>

                <button class="carousel-btn next" onclick="scrollCarousel('next')">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Success Toast -->
<div class="toast" id="addToCartToast">
    <i class="fas fa-check-circle"></i>
    <span>Prodotto aggiunto al carrello!</span>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/product_detail.js') }}?v=300"></script>
{% endblock %}
